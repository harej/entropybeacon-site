<link rel="stylesheet" href="bootstrap.min.css">
<link rel="stylesheet" href="style.css">
<meta charset="utf-8">

<title>Skynet Entropy Beacon</title>

<div style="margin:0 auto; max-width:1000px; padding-bottom:2em;">
	<h2 class="green">Skynet Entropy Beacon</h2>
	<p>The Skynet Entropy Beacon provides securely generated randomness, produced by the beacon of your choice, delivered through the decentralized content network Skynet.</p>
	<p>Lightweight beacons that anyone can run post random data on Skynet approximately once every 30 seconds, and this randomness can be used if you do not trust your user or device to provide genuinely random data. Each random data beacon is identified by its public key, and this public key can be used to verify the signature associated with the random data, so you can be sure that the data comes from the source it claims to come from.</p>
	<p>The beacons also upload a timestamp at approximately the same time they upload the random data. These timestamps should be treated as approximations, and the Entropy Beacon should not be considered a timestamping service.</p>
</div>

<table id="contentTable" style="padding-top:5rem; margin:1rem; width:98%">
	<tbody>
		<tr>
			<th>Label</th>
			<th>Public Key</th>
			<th>Random Data</th>
			<th>Timestamp</th>
		</tr>
	</tbody>
</table>

<script src="https://sky-id.hns.siasky.net/skyid.js"></script>
<script>
	var skyid = new SkyID('app', null);
	var sky = skyid.skynetClient;
	var pubkeys = [
		'd2ce0810c868c63c665eab97706a0dd06be27b092c527c06830a1602262cbfe5'
	];

	for (var i = 0; i < pubkeys.length; i++) {
		var pubkey = pubkeys[i];
		var table = document.getElementById('contentTable');
		var row = table.insertRow(i+1);
		var labelCell = row.insertCell(0);
		var pubkeyCell = row.insertCell(1);
		var randomnessCell = row.insertCell(2);
		var timestampCell = row.insertCell(3);

		pubkeyCell.innerHTML = `<input style="width:90%;" type="text" readonly value="` + pubkey + `" id="pubkey` + i + `">`
		labelCell.innerHTML = `<input style="width:90%;" type="text" readonly value="Loading..." id=label` + i + `">`;
		randomnessCell.innerHTML = `<input style="width:90%;" type="text" readonly value="Loading..." id=randomness` + i + `">`;
		timestampCell.innerHTML = `<input style="width:90%;" type="text" readonly value="Loading..." id=timestamp` + i + `">`;

		sky.registry.getEntry(pubkey, 'entropybeacon:data')
			.then((result) => {
				var randomness = result.entry.data;
				sky.registry.getEntry(pubkey, 'entropybeacon:time')
					.then((result2) => {
						var timestamp = result2.entry.data;
						sky.registry.getEntry(pubkey, 'entropybeacon:label')
							.then((result3) => {
								var label = result3.entry.data;
								labelCell.innerHTML = `<input style="width:90%;" type="text" readonly value="` + label + `" id=label` + i + `">`;
								randomnessCell.innerHTML = `<input style="width:90%;" type="text" readonly value="` + randomness + `" id=randomness` + i + `">`;
								timestampCell.innerHTML = `<input style="width:90%;" type="text" readonly value="` + timestamp + `" id=timestamp` + i + `">`;
							}).catch((error3) => {
								console.log('Could not retrieve label.')
								console.error(error3);
							})
					}).catch((error2) => {
						console.log('Could not retrieve time.')
						console.error(error2);
					})
			})
			.catch((error) => {
				console.log('Could not retrieve randomness.')
				console.error(error);
			});
	}

</script>
